# Java 构造器引用 (::new) 知识总结

构造器引用是 Java 8 引入的一种特殊方法引用，用于简化创建对象的 Lambda 表达式。以下是构造器引用的全面总结：

## 一、基本概念

构造器引用使用 `类名::new` 的形式，可以看作是创建对象的一种快捷方式。

## 二、语法形式

| 场景    | 语法        | 等效 Lambda 表达式            |
|-------|-----------|--------------------------|
| 无参构造器 | `类名::new` | `() -> new 类名()`         |
| 带参构造器 | `类名::new` | `(args) -> new 类名(args)` |

## 三、使用场景

### 1. 与函数式接口配合使用

```java
// Supplier<T> 接口
Supplier<List<String>> listSupplier = ArrayList::new;
List<String> list = listSupplier.get();

// Function<T,R> 接口
Function<Integer, int[]> arrayCreator = int[]::new;
int[] arr = arrayCreator.apply(10); // 创建长度为10的数组
```

### 2. 数组创建

```java
// 创建字符串数组
Function<Integer, String[]> stringArrayCreator = String[]::new;
String[] strArray = stringArrayCreator.apply(5); // 长度为5的字符串数组
```

### 3. 集合框架中的应用

```java
// 转换为特定类型的集合
List<String> names = Arrays.asList("Alice", "Bob", "Charlie");
Set<String> nameSet = names.stream()
                          .collect(Collectors.toCollection(HashSet::new));
```

### 4. 工厂模式简化

```java
interface PersonFactory<P extends Person> {
    P create(String name, int age);
}

// 使用构造器引用
PersonFactory<Person> factory = Person::new;
Person person = factory.create("John", 30);
```

## 四、不同类型构造器引用示例

### 1. 无参构造器

```java
Supplier<StringBuilder> supplier = StringBuilder::new;
StringBuilder sb = supplier.get(); // 等价于 new StringBuilder()
```

### 2. 单参数构造器

```java
Function<String, BigInteger> bigIntCreator = BigInteger::new;
BigInteger bi = bigIntCreator.apply("12345"); // new BigInteger("12345")
```

### 3. 多参数构造器

```java
BiFunction<String, Integer, Person> personCreator = Person::new;
Person p = personCreator.apply("Alice", 25); // new Person("Alice", 25)
```

## 五、特殊用法

### 1. 泛型类构造器引用

```java
// 定义泛型工厂接口
interface Factory<T> {
    T create();
}

// 使用构造器引用
Factory<ArrayList<String>> listFactory = ArrayList::new;
ArrayList<String> strList = listFactory.create();
```

### 2. 二维数组创建

```java
Function<Integer, int[][]> twoDArrayCreator = int[][]::new;
int[][] matrix = twoDArrayCreator.apply(5); // 创建5行的二维数组
```

## 六、注意事项

1. **匹配的函数式接口**：构造器引用必须与目标函数式接口的方法签名匹配
   ```java
   // 错误示例 - 参数不匹配
   Supplier<Person> wrong = Person::new; // 如果Person没有无参构造器会编译错误
   ```

2. **构造器可见性**：引用的构造器必须有足够的访问权限

3. **数组构造器引用**：对于数组，`类型[]::new` 等同于 `length -> new 类型[length]`

4. **与普通方法引用的区别**：
    - 构造器引用总是创建新对象
    - 方法引用可能是对现有方法的引用

5. **性能考虑**：构造器引用与等效的 Lambda 表达式在性能上没有区别

## 七、实际应用案例

### 1. 对象列表转换

```java
List<String> names = Arrays.asList("Alice", "Bob", "Charlie");
List<Person> people = names.stream()
                         .map(name -> new Person(name))
                         // 等价于
                         .map(Person::new)
                         .collect(Collectors.toList());
```

### 2. 自定义收集器

```java
List<String> list = Stream.of("a", "b", "c")
                        .collect(Collectors.toCollection(LinkedList::new));
```

### 3. 策略模式实现

```java
Map<String, Supplier<Shape>> shapeFactories = new HashMap<>();
shapeFactories.put("circle", Circle::new);
shapeFactories.put("square", Square::new);

Shape circle = shapeFactories.get("circle").get();
```

构造器引用是 Java 中一种强大的语法糖，它能让代码更加简洁清晰，特别是在函数式编程和流式处理中。合理使用构造器引用可以显著提高代码的可读性和编写效率。