---

### **Java 可变参数（Varargs）总结**

---

#### **1. 基本概念**

- **定义**：可变参数（Variable-Length Arguments）允许方法接受 **0个或多个相同类型** 的参数，语法为 `类型... 参数名`。
- **底层实现**：可变参数本质上是 **数组**。编译器会将 `method(String... args)` 转换为 `method(String[] args)`。

---

#### **2. 语法规则**

- **声明方式**：
  ```java
  public void printValues(String... values) {
      // values 是一个 String 数组
      for (String s : values) {
          System.out.println(s);
      }
  }
  ```
- **调用方式**：
  ```java
  printValues("A", "B", "C"); // 传入多个参数
  printValues();              // 传入空参数
  ```

- **约束**：
    - 一个方法只能有一个可变参数。
    - 可变参数必须是方法的 **最后一个参数**。
  ```java
  // 正确示例
  void method(int a, String... strs) {} 

  // 错误示例（可变参数不是最后一个）
  void method(String... strs, int a) {} 
  ```

---

#### **3. 使用场景**

- **灵活的参数传递**：
    - 替代手动创建数组，简化代码。
  ```java
  // 传统方式（需显式创建数组）
  sum(new int[]{1, 2, 3});

  // 可变参数方式（更简洁）
  sum(1, 2, 3);
  ```
- **常见应用**：
    - 日志工具方法（如 `String.format`）。
    - 工具类方法（如集合初始化）。

---

#### **4. 注意事项**

- **参数可为空**：
    - 可变参数可以接受 `null`，但需处理空指针。
  ```java
  printValues(null); // values 为 null（需判空）
  ```
- **避免重载歧义**：
    - 重载方法时，可变参数可能导致歧义。
  ```java
  void test(int... nums) {}
  void test(int a, int... nums) {} 

  test(1); // 编译错误：两个方法都匹配
  ```

- **性能优化**：
    - 频繁调用可变参数方法可能生成大量临时数组。对性能敏感的场景可改用重载方法。
  ```java
  // 优化示例：为常见参数数量提供重载
  void method() {}
  void method(int a) {}
  void method(int a, int b) {}
  void method(int... nums) {} // 处理更多参数
  ```

- **自动装箱问题**：
    - 基本类型的可变参数会自动装箱为包装类数组。
  ```java
  void sum(Integer... nums) {}

  sum(1, 2, 3); // 自动装箱为 Integer[]
  ```

---

#### **5. 与数组的互操作性**

- **数组传递**：
    - 可以直接将数组传递给可变参数。
  ```java
  String[] arr = {"A", "B"};
  printValues(arr); // 等价于 printValues("A", "B")
  ```
- **数组返回**：
    - 可变参数方法返回的数组可被修改。
  ```java
  public String[] getValues(String... values) {
      return values;
  }

  String[] result = getValues("A", "B");
  result[0] = "C"; // 修改会影响原数组
  ```

---

#### **6. 最佳实践**

1. **明确文档**：在方法注释中说明可变参数的用途和限制。
2. **防御性编程**：
   ```java
   public void safeMethod(String... values) {
       if (values == null) {
           values = new String[0]; // 防止 null
       }
       // 后续逻辑
   }
   ```
3. **优先使用标准库**：如 `List.of()` 替代自定义可变参数方法。

---

#### **7. 示例代码**

```java
public class VarargsDemo {
    // 计算多个整数之和
    public static int sum(int... numbers) {
        int sum = 0;
        for (int num : numbers) {
            sum += num;
        }
        return sum;
    }

    public static void main(String[] args) {
        System.out.println(sum(1, 2));        // 输出 3
        System.out.println(sum(1, 2, 3, 4));  // 输出 10
        System.out.println(sum());            // 输出 0
    }
}
```

---

### **总结**

- **优势**：简化代码，提高灵活性。
- **陷阱**：注意空指针、重载歧义和性能问题。
- **适用场景**：参数数量不确定且类型一致的场景。